{{extend 'layout.html'}}

{{=form.custom.begin}}
{{=T('Fee earner')}}: {{=form.custom.widget.fee_earner}}
{{=form.custom.submit}}
{{=form.custom.end}}
<br/>
<div id="calendar"></div>

<script type="text/javascript">
    $(function(){
	{{if session.current_date:}}
	var d = $.fullCalendar.parseDate("{{=session.current_date}}"); 
	{{pass}}
	var calendar = $("#calendar").fullCalendar({
	    {{if session.current_date:}}
	    year:  d.getFullYear(),
	    month: d.getMonth(),
	    date: d.getDate(),
	    {{pass}}
	    {{ if session.view:}}
	    defaultView: '{{=session.view}}',
	    {{pass}}
	    theme: true,
	    header: {
		left: 'prev,next today',
		center: 'title',
		right: 'month,agendaWeek,agendaDay'
	    },
	    events: "{{=URL('entries')}}",
	    eventDrop: function(event, delta) {
		$.get("{{=URL('entry_drop')}}/" + event.id + "/" + Math.round(event.start.getTime()/1000.0));
	    },
	    selectable: true,
	    selectHelper: true,
	    select: function(start, end, allDay) {		
		window.location="{{=URL('entry_new')}}/?start=" + Math.round(start.getTime()/1000.0) + "&end=" + Math.round(end.getTime()/1000.0); 
		calendar.fullCalendar('unselect');
	    },
	    editable: true,
	    eventRender: function(event, element) {
		element.qtip({
		    content: event.description,
		    style: { name: 'light', tip: true, border: {width: 2, radius: 8, color: '#6699CC'} }
		});
	    },
	    viewDisplay: function(view) {
		$.get("{{=URL('change_view')}}/" + view.name);
	    }
	});

    });
</script>
