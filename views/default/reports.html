{{extend 'layout.html'}}

{{=form}}

<h2 title="{{=str(entries_set.query)}}">{{=entries_set.count()}} {{=T('time entries')}}</h2>
<h3>{{=T('Current selection')}}</h3>
<b>
{{=T('Fee eraner')}}: {{if form.vars.fee_earner:}}{{=db.auth_user(form.vars.fee_earner).first_name}}{{else:}}ALL{{pass}}<br/>
{{=T('Client')}}: {{if form.vars.client:}}{{=db.client(form.vars.client).name}}{{else:}}ALL{{pass}}<br/>
{{=T('Matter')}}: {{if form.vars.matter:}}{{=db.matterr(form.vars.matter).name}}{{else:}}ALL{{pass}}<br/>
{{=T('Start')}}: {{=form.vars.start or "NOT SPECIFIED"}}<br/>
{{=T('End')}}: {{=form.vars.end or "NOT SPECIFIED"}}<br/>
</b>
<a href="{{=URL('default', 'reports.csv')}}">{{=T('Download as CSV')}}</a>
<a href="{{=URL('default', 'reports.pdf')}}">{{=T('Download as PDF')}}</a>

<br/>
<div class="rep">
<div class="left">
  <table>
    <thead>
      <tr>
	<th>User</th>
	<th>{{=T('Time spent')}}</th>
      </tr>
    </thead>
    <tbody>
      {{for elem in earners:}}
      <tr>
	<td width="300px">{{=elem.auth_user.first_name}}</td>
	<td>{{=elem['SUM(time_entry.duration)']}}</td>
      </tr>
      {{pass}}
    </tbody>
  </table>
  
</div>
<div class="right">{{=plugin_wiki.widget('pie_chart', data=earner_durations ,names=earner_names)}}</div>
</div>
<div class="rep">
<div class="left">
<table>
    <thead>
      <tr>
	<th>Client</th>
	<th>{{=T('Time spent')}}</th>
      </tr>
    </thead>
    <tbody>
      {{for elem in clients:}}
      <tr>
	<td width="300px">{{=elem.client.name}}</td>
	<td>{{=elem['SUM(time_entry.duration)']}}</td>
      </tr>
      {{pass}}
    </tbody>
  </table>
</div>
<div class="right">{{=plugin_wiki.widget('pie_chart', data=client_durations ,names=client_names)}}</div>
</div>

<div class="rep">
<div class="left">
<table>
    <thead>
      <tr>
	<th>Matter</th>
	<th>{{=T('Time spent')}}</th>
      </tr>
    </thead>
    <tbody>
      {{for elem in matters:}}
      <tr>
	<td width="300px">{{=elem.matter.name}}</td>
	<td>{{=elem['SUM(time_entry.duration)']}}</td>
      </tr>
      {{pass}}
    </tbody>
</table>
</div>
<div class="right">{{=plugin_wiki.widget('pie_chart', data=matter_durations ,names=matter_names)}}</div>
</div>
<br/>

<table>
<thead>
<tr>
  <th>{{=T('Date')}}</th>
  <th>{{=T('Fee earner')}}</th>
  <th>{{=T('Client')}}</th>
  <th>{{=T('Matter')}}</th>
  <th>{{=T('Duration')}}</th>
  <th>{{=T('Description')}}</th>
</tr>
</thead>
<tbody>
  {{for entry in entries:}}
  <tr>
    <td>{{=entry.time_entry.date}}
    <td>{{=entry.auth_user.first_name}}</td>
    <td>{{=entry.client.name}}</td>
    <td>{{=entry.matter.name}}</td>
    <td>{{=entry.time_entry.duration}}</td>
    <td>{{=entry.time_entry.description}} </td>
  </tr>
{{pass}}
</tbody>
</table>
